<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TokenMate AI</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#111827;
      --header:#020617;
      --accent:#22d3ee;
      --muted:#9ca3af;
      --text:#e5e7eb;
    }
    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100%;
      display:flex;
      flex-direction:column;
    }

    /* Header */
    header{
      background:var(--header);
      padding:12px 14px;
      text-align:center;
      font-weight:700;
      color:var(--accent);
      flex:0 0 auto;
    }
    .disclaimer{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
      font-weight:400;
      opacity:.9;
    }

    /* Tabs */
    nav{
      background:var(--header);
      display:flex;
      gap:0;
      border-bottom:1px solid rgba(255,255,255,.06);
      flex:0 0 auto;
    }
    nav button{
      flex:1;
      padding:12px;
      background:transparent;
      border:0;
      color:var(--muted);
      cursor:pointer;
      font-weight:600;
    }
    nav button.active{
      color:var(--accent);
      border-bottom:2px solid var(--accent);
    }

    /* Main area */
    main{
      flex:1 1 auto;
      min-height:0; /* IMPORTANT: allows scrolling inside */
      display:flex;
      flex-direction:column;
    }

    .view{
      display:none;
      padding:14px;
      overflow:auto;
      flex:1 1 auto;
      min-height:0;
    }
    .view.active{ display:block; }

    .card{
      background:var(--panel);
      border-radius:14px;
      padding:14px;
      margin-bottom:12px;
      border:1px solid rgba(255,255,255,.06);
    }

    /* Chat */
    .messages{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding-bottom:12px;
    }
    .message{
      max-width:78%;
      padding:12px;
      border-radius:12px;
      line-height:1.35;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .message.ai{
      background:var(--panel);
      align-self:flex-start;
    }
    .message.user{
      background:var(--accent);
      color:var(--header);
      align-self:flex-end;
    }

    .composer{
      display:flex;
      gap:10px;
      padding:12px;
      background:var(--header);
      border-top:1px solid rgba(255,255,255,.06);
      flex:0 0 auto;
    }
    .composer input{
      flex:1;
      border:1px solid rgba(255,255,255,.10);
      background:#0f172a;
      color:var(--text);
      padding:12px;
      border-radius:12px;
      outline:none;
    }
    .composer button{
      border:0;
      background:var(--accent);
      color:var(--header);
      font-weight:700;
      padding:12px 16px;
      border-radius:12px;
      cursor:pointer;
      white-space:nowrap;
    }
    .composer button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
  </style>
</head>

<body>
  <header>
    TokenMate AI
    <div class="disclaimer">‚ö†Ô∏è Educational purposes only ‚Äî not financial advice.</div>
  </header>

  <nav>
    <button id="tab-chat" class="active" type="button">Chat</button>
    <button id="tab-portfolio" type="button">Portfolio</button>
    <button id="tab-builder" type="button">App Builder</button>
  </nav>

  <main>
    <!-- CHAT VIEW -->
    <section id="view-chat" class="view active" aria-label="Chat">
      <div class="messages" id="messages">
        <div class="message ai">üëã Welcome to TokenMate AI. Ask me about crypto or app ideas.</div>
      </div>
    </section>

    <!-- PORTFOLIO VIEW -->
    <section id="view-portfolio" class="view" aria-label="Portfolio">
      <div class="card">
        <h3 style="margin:0 0 10px 0;">Your Portfolio</h3>
        <div>BTC: 0.00</div>
        <div>ETH: 0.00</div>
        <div style="margin-top:8px; color:var(--muted);">Total Value: $0.00</div>
      </div>
    </section>

    <!-- BUILDER VIEW -->
    <section id="view-builder" class="view" aria-label="App Builder">
      <div class="card">
        <h3 style="margin:0 0 10px 0;">Create an App</h3>
        <div style="color:var(--muted); margin-bottom:10px;">
          Describe your app idea and TokenMate will help generate it (coming soon).
        </div>
        <input id="builderInput" placeholder="Example: A BTC price alert app with subscriptions..." />
        <button style="margin-top:10px; width:100%;" disabled>Generate App (Coming Soon)</button>
      </div>
    </section>

    <!-- COMPOSER (fixed area, always clickable) -->
    <div class="composer">
      <input id="chatInput" placeholder="Ask TokenMate..." autocomplete="off" />
      <button id="sendBtn" type="button">Send</button>
    </div>
  </main>

  <script>
    // Tab switching (NO event.target usage ‚Äî fixes Chromebook/mobile issues)
    const tabs = {
      chat: document.getElementById("tab-chat"),
      portfolio: document.getElementById("tab-portfolio"),
      builder: document.getElementById("tab-builder"),
    };
    const views = {
      chat: document.getElementById("view-chat"),
      portfolio: document.getElementById("view-portfolio"),
      builder: document.getElementById("view-builder"),
    };

    function setActive(tabName){
      Object.keys(tabs).forEach(k => tabs[k].classList.toggle("active", k === tabName));
      Object.keys(views).forEach(k => views[k].classList.toggle("active", k === tabName));
    }

    tabs.chat.addEventListener("click", () => setActive("chat"));
    tabs.portfolio.addEventListener("click", () => setActive("portfolio"));
    tabs.builder.addEventListener("click", () => setActive("builder"));

    // Real AI
    let chatHistory = [];
    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");

    async function sendChat(){
      const text = inputEl.value.trim();
      if(!text) return;

      // Ensure we are on chat view
      setActive("chat");

      // Render user bubble
      const u = document.createElement("div");
      u.className = "message user";
      u.textContent = text;
      messagesEl.appendChild(u);

      inputEl.value = "";
      inputEl.focus();

      chatHistory.push({ role:"user", content:text });

      // Thinking bubble
      const a = document.createElement("div");
      a.className = "message ai";
      a.textContent = "ü§ñ TokenMate is thinking...";
      messagesEl.appendChild(a);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      sendBtn.disabled = true;

      try{
        const r = await fetch("/api/chat", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ message: text, history: chatHistory })
        });

        const data = await r.json();
        const reply = data.reply || data.error || "‚ö†Ô∏è No response from AI.";

        a.textContent = reply;
        chatHistory.push({ role:"assistant", content: reply });
      }catch(e){
        a.textContent = "‚ùå Error connecting to AI.";
      }finally{
        sendBtn.disabled = false;
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }
    }

    sendBtn.addEventListener("click", sendChat);
    inputEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter") sendChat();
    });
  </script>
</body>
</html>
